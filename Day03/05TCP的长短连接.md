# tcp长连接和短连接

​	***TCP在真正的读写操作之前,server与client之间必须建立一个连接***

​	***当度写完成后,双方不需要这个连接时可以释放这个连接***

​	***连接建立通过三次握手,释放需要四次挥手***

​	***每个建立的连接都是需要消耗资源和时间的***

### TCP通信的整个过程如下图

![三次握手、四次挥手](D:\随笔\复习\Day03\素材\三次握手、四次挥手.png)

### 1.TCP短连接

模拟一种TCP短连接情况:

  1. *client向server发起连接请求*

  2. *server接到请求,确认并返回确认信息,双方建立连接*

  3. *client向server发送信息*

  4. *server回应client*

  5. *一次读写完成,双方都可以发起close()操作 #一般都是client发起close()操作,但也允许特殊情况*

  6. *短连接一般只会在 client/server 间传递一次读写操作！* 

     

### 2.TCP长连接

模拟一种长连接情况:

1. *client向server发起连接*
2. *server 接到请求，双方建立连接*
3. *client 向 server 发送消息*
4. *server 回应 client*
5. *一次读写完成，连接不关闭*
6. *后续读写操作...*
7. *长时间操作之后client发起关闭请求*

### 3.TCP长短连接操作过程

- 短连接的操作步骤是:

  建立连接----数据传输----关闭连接---建立连接----数据传输----关闭连接

  ![短连接](D:\随笔\复习\Day03\素材\短连接.png)

- 长连接操作:

  建立连接----数据传输----(保持连接)----数据传输----关闭连接![长连接](D:\随笔\复习\Day03\素材\长连接.png)

### 4.TCP长短连接的优缺点浅析

- 长连接可以省去叫多次的TCP的建立与关闭的操作,节约资源和时间

  对于频繁的请求可以用长连接

- client与server之间的连接如果一直不关闭:

  随着客户端的不断进入,server资源会紧张,server端需要采取将一些长时间没有读写操作的连接主动的关闭,以释放被占用资源:

  如果条件在允许就可以以客户端机器为颗粒度,限制每个客户端的最大连接书,

  可以避免某个无聊的客户端引起的积累的后端服务

- 短链接对于服务器来说比较便于管理,存在的连接都是有用的连接,不需要额外的控制手段.

- 但是如果客户请求频繁,将会在TCP的建立与关闭操作上浪费时间和带宽.

  

### 5.TCP长短连接的应用场景

- 长连接多用于频繁的操作,点对点的通讯,而且连接数不能太多

  每个TCP连接都需要三次握手,这需要时间,如果每个操作都是先连接,

  再操作时处理速度会降低,所以每个操作完成后都不断开,再次处理时就可以直接发送数据包,不需要再次建立tcp连接

- web网站的HTTP服务一般都用短连接,长连接会占用服务器资源,

  web网站频繁的访问,用短连接会节省一定的资源,

  用长连接,在面临大规模的访问请求时每个用户都占用一个连接时,服务器的资源会被完全占用,导致服务器容易爆机

